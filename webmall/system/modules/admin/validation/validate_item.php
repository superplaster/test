<?phpif (isset($_POST['add_item'])) {	$post_data = do_request($_POST, true);	$back_url = str_replace('&amp;', '&', base64_decode($_POST['back_path']));		save_input_values($_POST);		if (!$post_data)			set_msg('Please fill all fields', 'error', $back_url, 'item_msg');		if ($post_data['type'] == 'one') {		if (!_is_int($post_data['item_id'])) 			set_msg('Bad item id', 'error', $back_url, 'item_msg');					if (!_is_int($post_data['item_count'])) 			set_msg('Bad item count', 'error', $back_url, 'item_msg');					if (!_is_int($post_data['item_price'])) 			set_msg('Bad item price', 'error', $back_url, 'item_msg');				if ($post_data['item_image']) {			/*if (!preg_match('#^([A-Za-z0-9_-]+)$#', $post_data['item_image'])) 				set_msg('Bad image name', 'error', $back_url, 'item_msg');*/							if (!file_exists(SYS_ROOT . 'user/images/shop_icons/' . $post_data['item_image']))				set_msg('Image not exists', 'error', $back_url, 'item_msg');		}				remove_input_values($_POST);				mysql_query("INSERT INTO donate_items (item_name, item_price, item_count, item_id, item_ali, item_cat, item_pack, item_image) VALUES ('{$post_data['item_name']}','{$post_data['item_price']}','{$post_data['item_count']}','{$post_data['item_id']}','{$post_data['item_ali']}','{$post_data['item_cat']}','0','{$post_data['item_image']}')");		set_msg('Item added to shop', 'success', $back_url, 'item_msg');	} else {		$pack_names = '';		$pack_ids = '';		$pack_alis = '';		$pack_counts = '';			for ($i=1;$i<=$post_data['items_count'];$i++) {			if (!_is_int($post_data['item_id_' . $i])) 				set_msg('Bad item id', 'error', $back_url, 'item_msg');						if (!_is_int($post_data['item_count_' . $i])) 				set_msg('Bad item count', 'error', $back_url, 'item_msg');							$pack_names .= $post_data['item_name_' . $i] . ',';			$pack_ids .= $post_data['item_id_' . $i] . ',';			$pack_alis .= $post_data['item_ali_' . $i] . ',';			$pack_counts .= $post_data['item_count_' . $i] . ',';		}				if (substr($pack_names, -1) == ',') $pack_names = substr($pack_names, 0, -1);		if (substr($pack_ids, -1) == ',') $pack_ids = substr($pack_ids, 0, -1);		if (substr($pack_alis, -1) == ',') $pack_alis = substr($pack_alis, 0, -1);		if (substr($pack_counts, -1) == ',') $pack_counts = substr($pack_counts, 0, -1);				if ($post_data['item_image']) {			/*if (!preg_match('#^([a-z0-9_-]+)$#', $post_data['item_image'])) 				set_msg('Bad image name', 'error', $back_url, 'item_msg');*/							if (!file_exists(SYS_ROOT . 'user/images/shop_icons/' . $post_data['item_image']))				set_msg('Image not exists', 'error', $back_url, 'item_msg');		}				remove_input_values($_POST);				mysql_query("INSERT INTO donate_items (item_name, item_price, item_count, item_id, item_ali, item_cat, item_pack, item_image) VALUES ('{$pack_names}','{$post_data['item_price']}','{$pack_counts}','{$pack_ids}','{$pack_alis}','{$post_data['item_cat']}','1','{$post_data['item_image']}')") or die('wtf');		set_msg('Items pack added to shop', 'success', $back_url, 'item_msg');	}}if (isset($_POST['edit_item'])) {	$post_data = do_request($_POST, true);	$back_url = str_replace('&amp;', '&', base64_decode($_POST['back_path']));		if (!$post_data)		set_msg('Please fill all fields', 'error', $back_url, 'item_msg');			if ($post_data['type'] == 'one') {			if (!_is_int($post_data['item_id'])) 			set_msg('Bad item id', 'error', $back_url, 'item_msg');					if (!_is_int($post_data['item_count'])) 			set_msg('Bad item count', 'error', $back_url, 'item_msg');					if (!_is_int($post_data['item_price'])) 			set_msg('Bad item price', 'error', $back_url, 'item_msg');					if ($post_data['item_image']) {			/*if (!preg_match('#^([A-Za-z0-9_-]+)\.([a-z]+)$#', $post_data['item_image'])) 				set_msg('Bad image name', 'error', $back_url, 'item_msg');*/							if (!file_exists(SYS_ROOT . 'user/images/shop_icons/' . $post_data['item_image']))				set_msg('Image not exists', 'error', $back_url, 'item_msg');		}					mysql_query("UPDATE donate_items SET item_name = '{$post_data['item_name']}', item_price = '{$post_data['item_price']}', item_count = '{$post_data['item_count']}', item_id = '{$post_data['item_id']}', item_ali = '{$post_data['item_ali']}', item_cat = '{$post_data['item_cat']}', item_pack = '0', item_image = '{$post_data['item_image']}' WHERE id = '{$post_data['edit_id']}'") or die('error');		set_msg('Item updated', 'success', $back_url, 'item_msg');	} else {		$pack_names = '';		$pack_ids = '';		$pack_alis = '';		$pack_counts = '';			for ($i=1;$i<=$post_data['items_count'];$i++) {			if (!_is_int($post_data['item_id_' . $i])) 				set_msg('Bad item id', 'error', $back_url, 'item_msg');						if (!_is_int($post_data['item_count_' . $i])) 				set_msg('Bad item count', 'error', $back_url, 'item_msg');							$pack_names .= $post_data['item_name_' . $i] . ',';			$pack_ids .= $post_data['item_id_' . $i] . ',';			$pack_alis .= $post_data['item_ali_' . $i] . ',';			$pack_counts .= $post_data['item_count_' . $i] . ',';		}				if (substr($pack_names, -1) == ',') $pack_names = substr($pack_names, 0, -1);		if (substr($pack_ids, -1) == ',') $pack_ids = substr($pack_ids, 0, -1);		if (substr($pack_alis, -1) == ',') $pack_alis = substr($pack_alis, 0, -1);		if (substr($pack_counts, -1) == ',') $pack_counts = substr($pack_counts, 0, -1);				if ($post_data['item_image']) {			/*if (!preg_match('#^([A-Za-z0-9_-]+)$#', $post_data['item_image'])) 				set_msg('Bad image name', 'error', $back_url, 'item_msg');*/							if (!file_exists(SYS_ROOT . 'user/images/shop_icons/' . $post_data['item_image']))				set_msg('Image not exists', 'error', $back_url, 'item_msg');		}				remove_input_values($_POST);				mysql_query("UPDATE donate_items SET item_name = '{$pack_names}', item_price = '{$post_data['item_price']}', item_count = '{$pack_counts}', item_id = '{$pack_ids}', item_ali = '{$pack_alis}', item_cat = '{$post_data['item_cat']}', item_pack = '1', item_image = '{$post_data['item_image']}' WHERE id = '{$post_data['edit_id']}'") or die('wtf');		set_msg('Items pack updated', 'success', $back_url, 'item_msg');	}}?>